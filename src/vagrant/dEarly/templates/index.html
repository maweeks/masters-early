<!DOCTYPE HTML>
<html>
    <head>
        <title>dEarly</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
        <style>
            html {
                text-align: center;
            }
            body {
                margin: auto;
                max-width: 1200px;
            }
            .container {
                background-color: #AAA;
            }
            .content {
                max-height: 86%;
                overflow: scroll;
            }
            .half {
                background-color: #DDD;
                display: inline-block;
                /*float: left;*/
                height: 500px;
                margin: 0 1% 1% 1%;
                width: 98%;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>Welcome to dEarly</h1>
            <div>
                <div class="half" id="60seconds">
                    <h3>Last 60 Seconds:</h3>
                    <div class="content">
                        <ul id="60sec">
                        <script type="text/javascript">
                            chartData = "";
                            function cropData() {
                                latestTime = new Date(new Date(chartData[0]["timestamp"]) - 60000);
                                cuttingList = true;
                                while (cuttingList) {
                                    if ((latestTime) > (new Date(chartData[chartData.length -1]["timestamp"]))) {
                                        chartData.pop();
                                    }
                                    else {
                                        cuttingList = false;
                                    }
                                }
                            }

                            function updateData() {
                                var titleList = $.getJSON("/datasec", function() {
                                    newData = titleList.responseJSON["timecounts"];
                                    // console.log(newData)
                                    if (newData[0]["timestamp"] != chartData[0]["timestamp"]) {
                                        // console.log("new " + newData[0]["timestamp"] + " " + chartData[0]["timestamp"]);
                                        chartData = newData.concat(chartData);
                                        cropData();
                                        // console.log(chartData.length)
                                    }
                                    // else {
                                    //     console.log("old")
                                    //     console.log("old " + newData[0]["timestamp"] + " " + chartData[0]["timestamp"]);
                                    // }
                                })
                            }

                            function updateGraph() {
                                //
                            }

                            var titleList = $.getJSON("/datasecall", function() {
                                chartData = titleList.responseJSON["timecounts"];
                                // console.log(chartData);
                                cropData();
                                // console.log(chartData);
                                updateGraph();
                                setInterval(function() {
                                    updateData();
                                    updateGraph();
                                }, 900);
                            })
                        </script>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>